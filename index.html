<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart HSR | لوحة القيادة التنفيذية - نظام المراقبة وإدارة الجودة الرقمي</title>

    <meta name="description" content="نظام Smart HSR للمراقبة وإدارة الجودة الرقمي - لوحة تحكم تنفيذية متقدمة لإدارة الملاحظات الميدانية وتحليل البيانات بتقنية الذكاء الاصطناعي">
    <meta name="keywords" content="Smart HSR, إدارة الجودة, نظام المراقبة, لوحة تحكم, الذكاء الاصطناعي, تحليل البيانات">
    <meta name="author" content="Smart HSR">
    <meta name="robots" content="index, follow">

    <meta property="og:title" content="Smart HSR | نظام المراقبة وإدارة الجودة الرقمي">
    <meta property="og:description" content="لوحة تحكم تنفيذية متقدمة لإدارة الملاحظات الميدانية وتحليل البيانات بتقنية الذكاء الاصطناعي">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="ar_SA">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Smart HSR | نظام المراقبة وإدارة الجودة الرقمي">
    <meta name="twitter:description" content="لوحة تحكم تنفيذية متقدمة لإدارة الملاحظات الميدانية">

    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="alternate icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="favicon.svg">

    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    
    <style>
/* ------------------------------------------------------------------------------------------------ */
/* --- 1. Tailwind CSS (Content from output.css) --- */
/* ------------------------------------------------------------------------------------------------ */

*,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/*! tailwindcss v3.4.18 | MIT License | https://tailwindcss.com*/*,:after,:before{box-sizing:border-box;border-width:0;border-style:solid;border-color:theme(colors.gray.200, #e5e7eb)}:after,:before{--tw-content:''}\html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:theme(fontFamily.sans, ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji");font-feature-settings:theme(fontFamily.sans.fontFeatureSettings);font-variation-settings:theme(fontFamily.sans.fontVariationSettings)}\body{margin:0;line-height:inherit}\hr{height:0;color:inherit;border-top-width:1px}\abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}\h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}\a{color:inherit;text-decoration:inherit}\b,strong{font-weight:bolder}\code,kbd,pre,samp{font-family:theme(fontFamily.mono, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace);font-feature-settings:theme(fontFamily.mono.fontFeatureSettings);font-variation-settings:theme(fontFamily.mono.fontVariationSettings);font-size:1em}\small{font-size:80%}\sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}\sub{bottom:-.25em}\sup{top:-.5em}\table{text-indent:0;border-color:inherit;border-collapse:collapse}\button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;color:inherit;margin:0;padding:0}\button,select{text-transform:none}\button,[type='button'],[type='reset'],[type='submit']{-webkit-appearance:button;background-color:transparent;background-image:none}\:-moz-focusring{outline:1px dotted ButtonText}\:-moz-ui-invalid{border-color:theme(colors.red.500, #ef4444)}\fieldset{padding:0.25em 0.75em 0.5em}\legend{padding:0}\progress{vertical-align:baseline}\textarea{resize:vertical}\input::-webkit-outer-spin-button,input::-webkit-inner-spin-button{height:auto}\input:where([type='search']){-webkit-appearance:textfield;outline-offset:-2px}\::-webkit-inner-spin-button,\::-webkit-outer-spin-button{height:auto}\::-webkit-search-decoration{-webkit-appearance:none}\::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}\summary{display:list-item}\blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}\fieldset{margin:0;padding:0}\legend{padding:0}\menu,ol,ul{list-style:none;margin:0;padding:0}\textarea{resize:vertical}\input::-webkit-input-placeholder,textarea::-webkit-input-placeholder{opacity:1;color:theme(colors.gray.500, #6b7280)}\input:-ms-input-placeholder,textarea:-ms-input-placeholder{opacity:1;color:theme(colors.gray.500, #6b7280)}\input::-ms-input-placeholder,textarea::-ms-input-placeholder{opacity:1;color:theme(colors.gray.500, #6b7280)}\input::placeholder,textarea::placeholder{opacity:1;color:theme(colors.gray.500, #6b7280)}\button,[role="button"]{cursor:pointer}:disabled{cursor:default}\img,svg,video{display:block;vertical-align:middle}\img,video{max-width:100%;height:auto}
.absolute{position:absolute}.relative{position:relative}.top-0{top:0px}.bottom-0{bottom:0px}.right-0{right:0px}.left-0{left:0px}.inset-y-0{top:0px;bottom:0px}.z-10{z-index:10}.z-20{z-index:20}.z-50{z-index:50}.z-\\[100\\]{z-index:100}.m-0{margin:0px}.mr-1{margin-right:0.25rem}.mt-1{margin-top:0.25rem}.mr-2{margin-right:0.5rem}.mt-2{margin-top:0.5rem}.mb-2{margin-bottom:0.5rem}.ml-2{margin-left:0.5rem}.mr-3{margin-right:0.75rem}.mt-3{margin-top:0.75rem}.mb-3{margin-bottom:0.75rem}.ml-3{margin-left:0.75rem}.mt-4{margin-top:1rem}.mr-4{margin-right:1rem}.mb-4{margin-bottom:1rem}.ml-4{margin-left:1rem}.mx-4{margin-left:1rem;margin-right:1rem}.my-4{margin-top:1rem;margin-bottom:1rem}.mt-5{margin-top:1.25rem}.mb-5{margin-bottom:1.25rem}.ml-5{margin-left:1.25rem}.mr-6{margin-right:1.5rem}.ml-6{margin-left:1.5rem}.mt-8{margin-top:2rem}.ml-auto{margin-left:auto}.mr-auto{margin-right:auto}.mb-auto{margin-bottom:auto}.block{display:block}.flex{display:flex}.inline-flex{display:inline-flex}.grid{display:grid}.hidden{display:none}.h-\\[3px\\]{height:3px}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-10{height:2.5rem}.h-40{height:10rem}.h-full{height:100%}.h-screen{height:100vh}.w-3{width:0.75rem}.w-4{width:1rem}.w-5{width:1.25rem}.w-6{width:1.5rem}.w-10{width:2.5rem}.w-20{width:5rem}.w-\\[260px\\]{width:260px}.w-\\[400px\\]{width:400px}.w-full{width:100%}.min-w-0{min-width:0px}.max-w-\\[800px\\]{max-width:800px}.flex-1{flex:1 1 0%}.flex-shrink-0{flex-shrink:0}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x),var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.flex-col{flex-direction:column}.items-start{align-items:flex-start}.items-center{align-items:center}.justify-start{justify-content:flex-start}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-1{gap:0.25rem}.gap-2{gap:0.5rem}.gap-3{gap:0.75rem}.gap-4{gap:1rem}.gap-8{gap:2rem}.p-1{padding:0.25rem}.p-2{padding:0.5rem}.p-3{padding:0.75rem}.p-4{padding:1rem}.p-5{padding:1.25rem}.p-6{padding:1.5rem}.px-2{padding-left:0.5rem;padding-right:0.5rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.px-3{padding-left:0.75rem;padding-right:0.75rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.px-4{padding-left:1rem;padding-right:1rem}.py-4{padding-top:1rem;padding-bottom:1rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.py-5{padding-top:1.25rem;padding-bottom:1.25rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-6{padding-top:1.5rem;padding-bottom:1.5rem}.pb-12{padding-bottom:3rem}.pr-12{padding-right:3rem}.pl-12{padding-left:3rem}.pt-20{padding-top:5rem}.pt-\\[14px\\]{padding-top:14px}.pb-20{padding-bottom:5rem}.text-right{text-align:right}.text-center{text-align:center}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-5xl{font-size:3rem;line-height:1}.text-base{font-size:1rem;line-height:1.5rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-bold{font-weight:700}.font-extrabold{font-weight:800}.font-medium{font-weight:500}.font-semibold{font-weight:600}.tracking-tight{letter-spacing:-0.025em}.text-red-500{--tw-text-opacity:1;color:rgb(239 68 68/var(--tw-text-opacity))}.text-green-500{--tw-text-opacity:1;color:rgb(34 197 94/var(--tw-text-opacity))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128/var(--tw-text-opacity))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99/var(--tw-text-opacity))}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81/var(--tw-text-opacity))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55/var(--tw-text-opacity))}.text-blue-600{--tw-text-opacity:1;color:rgb(37 99 235/var(--tw-text-opacity))}.text-teal-600{--tw-text-opacity:1;color:rgb(13 148 136/var(--tw-text-opacity))}.text-teal-700{--tw-text-opacity:1;color:rgb(15 118 110/var(--tw-text-opacity))}.text-red-600{--tw-text-opacity:1;color:rgb(220 38 38/var(--tw-text-opacity))}.text-\\[\\#0b2b3a\\]{--tw-text-opacity:1;color:rgb(11 43 58/var(--tw-text-opacity))}.text-\\[\\#0b7b75\\]{--tw-text-opacity:1;color:rgb(11 123 117/var(--tw-text-opacity))}.text-\\[var\\(--color-navy\\)\\]{--tw-text-opacity:1;color:var(--color-navy)}.antialiased{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.underline{-webkit-text-decoration-line:underline;text-decoration-line:underline}.bg-red-500{--tw-bg-opacity:1;background-color:rgb(239 68 68/var(--tw-bg-opacity))}.bg-green-500{--tw-bg-opacity:1;background-color:rgb(34 197 94/var(--tw-bg-opacity))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(243 244 246/var(--tw-bg-opacity))}.bg-teal-50{--tw-bg-opacity:1;background-color:rgb(240 253 250/var(--tw-bg-opacity))}.bg-gray-50{--tw-bg-opacity:1;background-color:rgb(249 250 251/var(--tw-bg-opacity))}.bg-gray-200{--tw-bg-opacity:1;background-color:rgb(229 231 235/var(--tw-bg-opacity))}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235/var(--tw-bg-opacity))}.bg-red-600{--tw-bg-opacity:1;background-color:rgb(220 38 38/var(--tw-bg-opacity))}.bg-slate-900{--tw-bg-opacity:1;background-color:rgb(15 23 42/var(--tw-bg-opacity))}.bg-\\[var\\(--color-navy\\)\\]{--tw-bg-opacity:1;background-color:var(--color-navy)}.border{border-width:1px}.border-t{border-top-width:1px}.border-r{border-right-width:1px}.border-b{border-bottom-width:1px}.border-l{border-left-width:1px}.border-transparent{border-color:transparent}.border-white{--tw-border-opacity:1;border-color:rgb(255 255 255/var(--tw-border-opacity))}.border-gray-200{--tw-border-opacity:1;border-color:rgb(229 231 235/var(--tw-border-opacity))}.border-\\[var\\(--color-teal\\)\\]{border-color:var(--color-teal)}.border-\\[var\\(--color-navy\\)\\]{border-color:var(--color-navy)}.opacity-50{opacity:0.5}.opacity-90{opacity:0.9}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0/0.1),0 4px 6px -4px rgb(0 0 0/0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px rgb(0 0 0/0.1),0 8px 10px -6px rgb(0 0 0/0.1);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color),0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-\\[0_0_15px_rgba\\(0\\,0\\,0\\,0\\.3\\)\\]{--tw-shadow:0 0 15px rgba(0,0,0,0.3);--tw-shadow-colored:0 0 15px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-\\[0_10px_40px_rgba\\(0\\,0\\,0\\,0\\.3\\)\\]{--tw-shadow:0 10px 40px rgba(0,0,0,0.3);--tw-shadow-colored:0 10px 40px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-\\[0_4px_10px_var\\(--color-shadow-base\\)\\]{--tw-shadow:0 4px 10px var(--color-shadow-base);--tw-shadow-colored:0 4px 10px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.outline-none{outline:2px solid transparent;outline-offset:2px}.ring-0{--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow,0 0 #0000)}.ring-1{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000)}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.duration-300{transition-duration:300ms}.ease-in-out{transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1)}.rounded-lg{border-radius:0.5rem}.rounded-xl{border-radius:0.75rem}.rounded-\\[0\\.75rem\\]{border-radius:0.75rem}.rounded-\\[1\\.5rem\\]{border-radius:1.5rem}.rounded-full{border-radius:9999px}.rounded-t-lg{border-top-left-radius:0.5rem;border-top-right-radius:0.5rem}.rounded-b-lg{border-bottom-right-radius:0.5rem;border-bottom-left-radius:0.5rem}.rounded-r-lg{border-top-right-radius:0.5rem;border-bottom-right-radius:0.5rem}.rounded-l-lg{border-top-left-radius:0.5rem;border-bottom-left-radius:0.5rem}.rounded-tr-lg{border-top-right-radius:0.5rem}.rounded-br-lg{border-bottom-right-radius:0.5rem}.rounded-bl-lg{border-bottom-left-radius:0.5rem}.rounded-tl-\\[0\\.75rem\\]{border-top-left-radius:0.75rem}.hover\\:bg-gray-100:hover{--tw-bg-opacity:1;background-color:rgb(243 244 246/var(--tw-bg-opacity))}.hover\\:bg-teal-50:hover{--tw-bg-opacity:1;background-color:rgb(240 253 250/var(--tw-bg-opacity))}.hover\\:bg-teal-600:hover{--tw-bg-opacity:1;background-color:rgb(13 148 136/var(--tw-bg-opacity))}.hover\\:text-teal-600:hover{--tw-text-opacity:1;color:rgb(13 148 136/var(--tw-text-opacity))}.focus\\:border-\\[var\\(--color-teal\\)\\]:focus{border-color:var(--color-teal)}.focus\\:border-green-500:focus{--tw-border-opacity:1;border-color:rgb(34 197 94/var(--tw-border-opacity,1))}.focus\\:ring-\\[--color-teal\\]:focus{--tw-ring-color:var(--color-teal)}.focus\\:ring-green-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(34 197 94/var(--tw-ring-opacity,1))}
@media (min-width:640px){.sm\\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.sm\\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.sm\\:px-6{padding-left:1.5rem;padding-right:1.5rem}}
@media (min-width:768px){.md\\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.md\\:grid-cols-7{grid-template-columns:repeat(7,minmax(0,1fr))}.md\\:border-b-0{border-bottom-width:0}.md\\:border-l{border-left-width:1px}.md\\:p-12{padding:3rem}.md\\:p-8{padding:2rem}.md\\:py-16{padding-top:4rem;padding-bottom:4rem}.md\\:text-3xl{font-size:1.875rem;line-height:2.25rem}}
@media (min-width:1024px){.lg\\:col-span-2{grid-column:span 2/span 2}.lg\\:col-span-5{grid-column:span 5/span 5}.lg\\:grid-cols-12{grid-template-columns:repeat(12,minmax(0,1fr))}.lg\\:flex-row{flex-direction:row}.lg\\:gap-8{gap:2rem}.lg\\:p-4{padding:1rem}.lg\\:pl-0{padding-left:0px}.lg\\:pr-8{padding-right:2rem}.lg\\:text-left{text-align:left}}

/* ------------------------------------------------------------------------------------------------ */
/* --- 2. Custom Dashboard Styles (from Smart HSR html.txt) --- */
/* ------------------------------------------------------------------------------------------------ */

        :root {
            /* Professional & Executive Palette (Dashboard) */
            --color-navy: #0A1931;
            /* Primary Dark Color */
            --color-teal: #18A5A2;
            /* Accent/Highlight Color */
            --color-light-teal: #ACE2E1;
            /* Light Accent */
            --color-gray-bg: #F7F9FC;
            /* Clean Background */
            --color-shadow-base: rgba(10, 25, 49, 0.4);
            /* Deep Navy Shadow */
            
            /* Login Palette (Added for consistency) */
            --primary1: #0ea5a1; /* Teal shade for login */
            --primary2: #0b7285; /* Darker teal shade for login */
            --card-bg: #ffffff; /* Card background for login */
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--color-gray-bg);
            color: var(--color-navy);
            /* Default body style for Dashboard */
        }

        /* Gradient for Open Reports (Urgency - Red/Orange) */
        .kpi-open-gradient {
            background: linear-gradient(135deg, #EF4444 0%, #B91C1C 100%);
            /* Red to Deep Red */
            color: white;
            box-shadow: 0 10px 20px rgba(185, 28, 28, 0.4);
        }

        /* Gradient for Closed Reports (Success - Teal/Green) */
        .kpi-closed-gradient {
            background: linear-gradient(135deg, #10B981 0%, #18A5A2 100%);
            /* Green to Teal */
            color: white;
            box-shadow: 0 10px 20px rgba(24, 165, 162, 0.4);
        }

        /* Gradient for Total Images (Information - Blue/Navy) */
        .kpi-images-gradient {
            background: linear-gradient(135deg, #3B82F6 0%, #0A1931 100%);
            /* Blue to Navy */
            color: white;
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.4);
        }

        /* Gradient for Missing Images (Warning - Yellow/Orange) */
        .kpi-missing-gradient {
            background: linear-gradient(135deg, #FCD34D 0%, #F97316 100%);
            /* Yellow to Orange */
            color: var(--color-navy);
            /* Dark text for contrast on light gradient */
            box-shadow: 0 10px 20px rgba(253, 211, 77, 0.4);
        }

        /* Common KPI Card Styles */
        .kpi-card-professional {
            transition: all 0.3s ease;
            border-radius: 1.5rem;
            /* Rounded corners */
            position: relative;
            overflow: hidden;
            transform: perspective(1px) translateZ(0);
            /* For hardware acceleration */
        }

        .kpi-card-professional::before {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 5px;
            background-color: rgba(255, 255, 255, 0.2);
            transition: height 0.3s ease;
        }

        .kpi-card-professional:hover {
            transform: translateY(-8px) scale(1.02);
            z-index: 10;
        }

        .kpi-card-professional:hover::before {
            height: 100%;
            opacity: 0.1;
        }

        /* General UI Elements */
        .ai-button-primary {
            background-color: var(--color-teal);
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 6px 15px rgba(24, 165, 162, 0.5);
        }

        .ai-button-primary:hover:not(:disabled) {
            background-color: #148f8c;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(24, 165, 162, 0.8);
        }

        .ai-button-secondary {
            background-color: var(--color-navy);
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(10, 25, 49, 0.6);
        }

        .ai-button-secondary:hover:not(:disabled) {
            background-color: #1a3053;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(10, 25, 49, 0.8);
        }

        /* Vision Button Style (Purple) */
        .ai-button-vision {
            background-color: #9333ea;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 6px 15px rgba(147, 51, 234, 0.5);
        }

        .ai-button-vision:hover:not(:disabled) {
            background-color: #7e22ce;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(147, 51, 234, 0.8);
        }

        /* Root Cause Button Style (Dark Red/Maroon) */
        .ai-button-root-cause {
            background-color: #881337;
            /* Maroon 900 */
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 6px 15px rgba(136, 19, 55, 0.5);
        }

        .ai-button-root-cause:hover:not(:disabled) {
            background-color: #9f1239;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(136, 19, 55, 0.8);
        }

        /* Communication Button Style (Orange) */
        .ai-button-comm {
            background-color: #F97316;
            /* Orange */
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 6px 15px rgba(249, 115, 22, 0.5);
        }

        .ai-button-comm:hover:not(:disabled) {
            background-color: #ea580c;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(249, 115, 22, 0.8);
        }

        /* Grounding Button Style (Green) */
        .ai-button-grounding {
            background-color: #10B981;
            /* Green */
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 6px 15px rgba(16, 185, 129, 0.5);
        }

        .ai-button-grounding:hover:not(:disabled) {
            background-color: #059669;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.8);
        }

        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--color-light-teal);
            /* Use light teal on dark buttons */
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin-left: 8px;
        }

        .ai-button-primary .loading-spinner,
        .ai-button-vision .loading-spinner,
        .ai-button-comm .loading-spinner,
        .ai-button-grounding .loading-spinner,
        .ai-button-secondary .loading-spinner,
        .ai-button-root-cause .loading-spinner {
            border-top: 4px solid #0A1931;
            /* Darker spinner on lighter buttons */
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .image-container {
            position: relative;
            overflow: hidden;
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px var(--color-shadow-base);
        }

        .image-label {
            position: absolute;
            bottom: 0;
            right: 0;
            background-color: var(--color-navy);
            color: white;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            font-weight: 700;
            border-top-left-radius: 0.75rem;
        }

        .observation-item {
            transition: all 0.2s;
            border-right: 4px solid transparent;
            cursor: pointer;
        }

        .observation-item:hover {
            background-color: #E6F3F3;
            /* Light teal hover effect */
            border-right-color: var(--color-teal);
        }

        .observation-item.active {
            background-color: #E6F3F3;
            /* Active state */
            border-right-color: var(--color-navy);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        /* Image Comparison Slider Styles */
        .comparison-wrapper {
            position: relative;
            max-width: 100%;
            overflow: hidden;
            user-select: none;
            cursor: ew-resize;
            /* East-West resize cursor */
            border-radius: 0.75rem;
        }

        .comparison-wrapper img,
        .comparison-wrapper video {
            display: block;
            width: 100%;
            height: auto;
        }

        .comparison-wrapper .after-image {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 50%;
            /* Initial mask width */
            overflow: hidden;
        }

        .comparison-wrapper .after-image img,
        .comparison-wrapper .after-image video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            /* Ensure the image fills the container */
            height: auto;
        }

        .comparison-wrapper .comparison-divider {
            position: absolute;
            top: 0;
            left: 50%;
            /* Initial position */
            width: 4px;
            height: 100%;
            background-color: var(--color-teal);
            transform: translateX(-50%);
            cursor: grab;
            z-index: 10;
            box-shadow: 0 0 10px rgba(24, 165, 162, 0.8);
            border-radius: 2px;
            transition: width 0.1s ease;
        }

        .comparison-wrapper .comparison-divider:active {
            cursor: grabbing;
        }

        .comparison-wrapper .comparison-divider-handle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background-color: white;
            border: 3px solid var(--color-teal);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
        }

        .comparison-label {
            position: absolute;
            z-index: 5;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            font-weight: 700;
            color: white;
            border-radius: 0.5rem;
            opacity: 0.9;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .label-before {
            top: 10px;
            right: 10px;
            background-color: #B91C1C;
            /* Red */
        }

        .label-after {
            top: 10px;
            left: 10px;
            background-color: #10B981;
            /* Green */
        }

        .communication-draft {
            white-space: pre-wrap;
            text-align: right;
            direction: rtl;
            font-family: 'Tajawal', sans-serif;
            border-right: 4px solid var(--color-teal);
            padding-right: 1rem;
            line-height: 1.8;
            background-color: #f8fafc;
        }

        .kpi-insight-container {
            border-radius: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border-top: 5px solid var(--color-navy);
        }

        .source-link {
            color: #0d9488;
            /* Teal 600 */
            text-decoration: none;
            transition: color 0.2s;
        }

        .source-link:hover {
            color: var(--color-navy);
            text-decoration: underline;
        }

        audio {
            width: 100%;
            margin-top: 10px;
        }

        /* Modal Styling */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
            align-items: center;
            /* Center the modal content vertically */
            justify-content: center;
            /* Center the modal content horizontally */
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border-radius: 1.5rem;
            width: 90%;
            max-width: 800px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slide-up 0.3s ease-out;
            position: relative;
        }

        /* Custom Location/Image Wrapper */
        .input-group-wrapper {
            display: flex;
            gap: 1rem;
            /* Space between inputs */
        }

        .input-group {
            flex-grow: 1;
            /* Make inputs fill available space */
            text-align: center;
        }

        /* PDF Print Styles (Hiding unnecessary elements when printing) */
        @media print {
            body {
                background-color: white !important;
                color: black !important;
                /* تحديد عرض الصفحة للـ PDF */
                width: 210mm;
                /* A4 width */
                min-height: 297mm;
                /* A4 height */
                margin: 0;
            }

            .no-print,
            #observationsList,
            #hero,
            #operational-dashboard,
            #ai-features,
            footer,
            .modal {
                display: none !important;
            }

            #observationDetail {
                display: block !important;
                max-width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
                box-shadow: none !important;
            }
        }

/* ------------------------------------------------------------------------------------------------ */
/* --- 3. Custom Login Styles (from login.html.txt) --- */
/* ------------------------------------------------------------------------------------------------ */

        /* General styles, applied to all elements */
        *{box-sizing:border-box}
        
        /* The container for the login page, separated from the main body for the dashboard */
        .login-page-container {
            display: none; /* Initially hidden, show only when needed */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            min-height: 100vh;
            background: linear-gradient(180deg, var(--color-gray-bg) 0%, #ffffff 100%); /* Using Dashboard background colors */
            align-items: center;
            justify-content: center;
            padding: 30px;
            z-index: 90; /* Below the dashboard modals */
        }
        
        /* Login Card */
        .card{
            width: 380px;
            background:var(--card-bg);
            border-radius:16px;
            box-shadow: 0 12px 30px rgba(10,20,50,0.09);
            padding:26px;
            position:relative;
            overflow:hidden;
        }
        .card:before{
            content:"";
            position:absolute;
            left:-40px;
            top:-40px;
            width:160px;
            height:60px;
            background:linear-gradient(90deg,var(--primary1),var(--primary2));
            border-radius:0 0 20px 20px;
            transform:rotate(6deg);
            opacity:0.95;
        }

        /* Typography */
        h1.login-title{
            margin:0 0 8px 0;
            text-align:center;
            font-size:26px;
            color:var(--color-navy); /* Using Dashboard Navy color */
            font-family: 'Tajawal', sans-serif;
        }
        p.lead{
            margin:0 0 18px 0;
            text-align:center;
            color: #0b7b75; /* Retaining the original green-teal shade */
            font-weight:600;
        }

        /* Form Fields */
        .field{margin-bottom:12px}
        .field label{
            display:block;
            margin-bottom:6px;
            color:#6b7a86;
            font-size:13px;
        }
        input[type="text"], input[type="email"], input[type="password"], input[type="tel"]{
            width:100%;
            padding:12px 14px;
            border-radius:10px;
            border:1px solid #e6eef2;
            background:#fbfeff;
            font-size:15px;
            outline:none;
        }
        input:focus{
            box-shadow:0 6px 18px rgba(11,39,55,0.06);
            border-color: #cfeff0;
        }
        .row{display:flex; gap:8px}

        /* Buttons */
        .btn{
            width:100%;
            padding:12px;
            border-radius:10px;
            border:none;
            cursor:pointer;
            font-weight:700;
            font-size:15px;
            transition: all 0.2s;
        }
        .btn-primary{
            background:linear-gradient(90deg,var(--primary1),var(--primary2));
            color:white;
            box-shadow:0 8px 18px rgba(14,165,161,0.25);
        }
        .btn-primary:hover{
            transform:translateY(-1px);
            box-shadow:0 10px 20px rgba(14,165,161,0.35);
        }
        .btn-link{
            background:transparent;
            color:#7a8a98;
            padding: 8px;
            font-weight:500;
        }
        .btn-link:hover{
            color:var(--primary2);
        }

        /* Utility */
        .text-small{font-size:12px}
        .error-msg, .success-msg{
            padding: 8px 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
            display: none;
            text-align: right;
        }
        .error-msg{background:#ffe3e3; color:#d64a4a}
        .success-msg{background:#e8fff9; color:#0b7b75}


    </style>
</head>

<body>
    
    <div id="login-page-container" class="login-page-container" style="display: flex;">
        <div class="card">
            <h1 class="login-title">Smart HSR</h1>
            <p class="lead">نظام المراقبة وإدارة الجودة الرقمي</p>

            <form onsubmit="sendOTP(event)">
                <div class="field">
                    <label for="phone">رقم الجوال (بدون رمز الدولة)</label>
                    <input type="tel" id="phone" name="phone" placeholder="مثال: 501234567" required>
                </div>
                
                <div id="otp-section" style="display: none;">
                    <div class="field">
                        <label for="otp-code">رمز التحقق المُرسَل</label>
                        <input type="text" id="otp-code" name="otp-code" placeholder="أدخل الرمز المكون من 6 أرقام">
                    </div>
                </div>

                <div class="field">
                    <button type="submit" id="send-btn" class="btn btn-primary">إرسال رمز التحقق</button>
                    <button type="button" id="verify-btn" class="btn btn-primary" onclick="verifyOTP()" style="display: none;">تسجيل الدخول</button>
                </div>
            </form>
            
            <div id="msg-box" class="error-msg" style="text-align: center;"></div>
            
            <div id="otp-actions" class="row mt-3" style="display: none;">
                <button class="btn btn-link" onclick="clearPhone()">تغيير الرقم</button>
                <button class="btn btn-link" onclick="resendOTP()">إعادة إرسال الرمز</button>
            </div>

            <div id="recaptcha-container"></div>

            <p class="text-small text-center mt-3" style="color:#a1a1a1;">باستخدامك للنظام، فإنك توافق على سياسة الخصوصية وشروط الاستخدام.</p>
        </div>
    </div>


    <div id="dashboard-page-container" style="display: none;">
        <header id="hero" class="bg-white sticky top-0 z-50 shadow-lg no-print">
            <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <img src="logo.svg" alt="Smart HSR Logo" class="h-10 w-auto">
                    <h1 class="text-3xl font-extrabold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-teal-600 to-teal-900">
                        Smart HSR</h1>
                </div>
                <div class="flex items-center gap-4">
                    <button onclick="toggleVisibility('dashboard-page-container', 'login-page-container')" class="ai-button-secondary rounded-full p-2" title="الخروج">
                        <i data-lucide="log-out" class="w-6 h-6"></i>
                    </button>
                    <button onclick="document.getElementById('profile-dropdown').classList.toggle('hidden')" class="bg-gray-200 rounded-full w-10 h-10 flex items-center justify-center text-lg font-bold text-gray-700">
                        س
                    </button>
                    <div id="profile-dropdown"
                        class="hidden absolute left-0 mt-32 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-20">
                        <div class="py-1" role="none">
                            <a href="#" class="text-gray-700 block px-4 py-2 text-sm hover:bg-gray-100">الإعدادات</a>
                            <button onclick="toggleVisibility('dashboard-page-container', 'login-page-container')"
                                class="text-gray-700 w-full text-right block px-4 py-2 text-sm hover:bg-gray-100">تسجيل الخروج</button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8 lg:py-16">

            <section id="operational-dashboard">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-2xl md:text-3xl font-extrabold text-gray-800">
                        لوحة القيادة التنفيذية
                    </h2>
                    <div class="flex gap-3">
                        <button onclick="filterObservations('all')" id="filter-all"
                            class="ai-button-secondary py-2 px-4 rounded-full text-sm font-semibold opacity-50">
                            الكل
                        </button>
                        <button onclick="filterObservations('open')" id="filter-open"
                            class="ai-button-secondary py-2 px-4 rounded-full text-sm font-semibold">
                            الملاحظات المفتوحة
                        </button>
                        <button onclick="filterObservations('closed')" id="filter-closed"
                            class="ai-button-secondary py-2 px-4 rounded-full text-sm font-semibold opacity-50">
                            الملاحظات المغلقة
                        </button>
                    </div>
                </div>

                <div id="kpi-cards" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 mb-12">
                    <div class="kpi-card-professional kpi-open-gradient p-6">
                        <div class="flex items-start justify-between">
                            <i data-lucide="clipboard-list" class="w-10 h-10"></i>
                            <span class="text-4xl font-extrabold" id="kpi-open">0</span>
                        </div>
                        <p class="mt-3 text-lg font-medium">ملاحظة مفتوحة</p>
                    </div>

                    <div class="kpi-card-professional kpi-closed-gradient p-6">
                        <div class="flex items-start justify-between">
                            <i data-lucide="check-square" class="w-10 h-10"></i>
                            <span class="text-4xl font-extrabold" id="kpi-closed">0</span>
                        </div>
                        <p class="mt-3 text-lg font-medium">ملاحظة مُعالجة</p>
                    </div>

                    <div class="kpi-card-professional kpi-images-gradient p-6">
                        <div class="flex items-start justify-between">
                            <i data-lucide="image" class="w-10 h-10"></i>
                            <span class="text-4xl font-extrabold" id="kpi-images">0</span>
                        </div>
                        <p class="mt-3 text-lg font-medium">صورة مُرفقة</p>
                    </div>

                    <div class="kpi-card-professional kpi-missing-gradient p-6">
                        <div class="flex items-start justify-between text-black">
                            <i data-lucide="alert-triangle" class="w-10 h-10"></i>
                            <span class="text-4xl font-extrabold" id="kpi-missing">0%</span>
                        </div>
                        <p class="mt-3 text-lg font-medium text-gray-800">جودة التوثيق</p>
                    </div>
                </div>

                <div id="kpi-insight-result" class="mb-12">
                    </div>
            </section>

            <div class="grid grid-cols-1 lg:grid-cols-12 lg:gap-8">

                <div class="lg:col-span-5 border-l md:border-l-0 lg:pr-8 border-gray-200 no-print">
                    <div class="sticky top-20">
                        <h3 class="text-xl font-bold mb-4 text-gray-800">
                            قائمة الملاحظات الأخيرة
                        </h3>
                        <div class="flex items-center gap-2 mb-4">
                            <input type="text" id="searchInput" onkeyup="searchObservations()" placeholder="بحث باسم الموقع أو القسم..."
                                class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:border-[var(--color-teal)] focus:ring-1 focus:ring-[--color-teal]">
                            <button onclick="clearSearch()"
                                class="bg-gray-200 hover:bg-gray-300 p-3 rounded-lg text-gray-700 flex-shrink-0">
                                <i data-lucide="x" class="w-5 h-5"></i>
                            </button>
                        </div>
                        <ul id="observationsList" class="space-y-3 max-h-[70vh] overflow-y-auto">
                            </ul>
                    </div>
                </div>

                <div class="lg:col-span-7 mt-8 lg:mt-0 lg:pl-0">
                    <div id="observationDetail" class="bg-white p-6 md:p-8 rounded-xl shadow-xl sticky top-20">
                        <div class="text-center py-20 text-gray-500" id="no-selection-message">
                            <i data-lucide="monitor" class="w-16 h-16 mx-auto mb-4"></i>
                            <p class="text-xl font-medium">الرجاء اختيار ملاحظة من القائمة لعرض التفاصيل.</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <div id="pdfModal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center pb-3 border-b border-gray-200">
                    <h4 class="text-2xl font-bold text-gray-800">إنشاء تقرير PDF للملاحظة</h4>
                    <button onclick="closeModal('pdfModal')" class="text-gray-500 hover:text-gray-800">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                <div class="py-6">
                    <p class="text-lg text-gray-700 mb-4">هل أنت متأكد من رغبتك في إنشاء تقرير PDF للملاحظة
                        <span id="pdf-modal-id" class="font-bold text-teal-600">#0</span>؟
                    </p>
                    <div class="flex justify-end gap-3 pt-4">
                        <button onclick="closeModal('pdfModal')"
                            class="py-2 px-4 rounded-lg text-gray-700 bg-gray-100 hover:bg-gray-200 font-medium transition">
                            إلغاء
                        </button>
                        <button onclick="generatePDF()" id="generatePdfButton"
                            class="ai-button-primary py-2 px-4 rounded-lg font-medium flex items-center justify-center">
                            <i data-lucide="file-text" class="w-5 h-5 mr-2"></i>
                            إنشاء التقرير
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="visionModal" class="modal">
            <div class="modal-content max-w-[900px] w-[90%]">
                <div class="flex justify-between items-center pb-3 border-b border-gray-200">
                    <h4 class="text-2xl font-bold text-purple-700 flex items-center gap-2">
                        <i data-lucide="eye" class="w-6 h-6"></i>
                        تحليل Vision AI للصور
                    </h4>
                    <button onclick="closeModal('visionModal')" class="text-gray-500 hover:text-gray-800">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                <div class="py-6">
                    <div id="vision-images" class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                        </div>
                    <div id="vision-result" class="bg-gray-50 p-4 rounded-lg border-l-4 border-purple-500">
                        <p class="font-bold text-purple-700 mb-2">نتائج التحليل الأولي:</p>
                        <p class="text-gray-700" id="vision-text-result">جاري تحليل الصور. الرجاء الانتظار...</p>
                    </div>
                    <div class="flex justify-end pt-4">
                        <button onclick="closeModal('visionModal')"
                            class="ai-button-secondary py-2 px-4 rounded-lg font-medium transition">
                            إغلاق
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="commModal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center pb-3 border-b border-gray-200">
                    <h4 class="text-2xl font-bold text-orange-600 flex items-center gap-2">
                        <i data-lucide="mail" class="w-6 h-6"></i>
                        مسودة بريد إلكتروني تنفيذي
                    </h4>
                    <button onclick="closeModal('commModal')" class="text-gray-500 hover:text-gray-800">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                <div class="py-6">
                    <div id="communication-draft-output" class="communication-draft p-4 rounded-lg border-r-4">
                        </div>
                    <div class="flex justify-end gap-3 pt-4">
                        <button onclick="copyToClipboard('communication-draft-output')"
                            class="ai-button-primary py-2 px-4 rounded-lg font-medium transition flex items-center gap-2">
                            <i data-lucide="copy" class="w-4 h-4"></i>
                            نسخ المسودة
                        </button>
                        <button onclick="closeModal('commModal')"
                            class="ai-button-secondary py-2 px-4 rounded-lg font-medium transition">
                            إغلاق
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="rootCauseModal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center pb-3 border-b border-gray-200">
                    <h4 class="text-2xl font-bold text-red-800 flex items-center gap-2">
                        <i data-lucide="zap" class="w-6 h-6"></i>
                        تحليل السبب الجذري (Root Cause)
                    </h4>
                    <button onclick="closeModal('rootCauseModal')" class="text-gray-500 hover:text-gray-800">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                <div class="py-6">
                    <div id="root-cause-output" class="bg-gray-50 p-4 rounded-lg border-l-4 border-red-800">
                        <p class="font-bold text-red-800 mb-2">السبب الجذري المُقترح (5 Whys):</p>
                        <ul id="root-cause-list" class="space-y-2 text-gray-700 list-disc pr-6 marker:text-red-600">
                            </ul>
                    </div>
                    <div class="flex justify-end pt-4">
                        <button onclick="closeModal('rootCauseModal')"
                            class="ai-button-secondary py-2 px-4 rounded-lg font-medium transition">
                            إغلاق
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="dynamicModal" class="modal">
            <div class="modal-content max-w-[900px] w-[90%]">
                <div class="flex justify-between items-center pb-3 border-b border-gray-200">
                    <h4 id="dynamic-modal-title" class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                        عنوان ديناميكي
                    </h4>
                    <button onclick="closeModal('dynamicModal')" class="text-gray-500 hover:text-gray-800">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                <div id="dynamic-modal-body" class="py-6">
                    </div>
                <div class="flex justify-end pt-4">
                    <button onclick="closeModal('dynamicModal')"
                        class="ai-button-secondary py-2 px-4 rounded-lg font-medium transition">
                        إغلاق
                    </button>
                </div>
            </div>
        </div>


        <footer class="bg-slate-900 py-6 mt-12 no-print">
            <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 text-center text-white">
                <p class="text-sm">
                    © 2024 Smart HSR - نظام المراقبة وإدارة الجودة الرقمي. جميع الحقوق محفوظة.
                </p>
                <div class="flex justify-center gap-4 mt-2">
                    <a href="#" class="text-gray-400 hover:text-teal-600 text-sm">شروط الخدمة</a>
                    <a href="#" class="text-gray-400 hover:text-teal-600 text-sm">سياسة الخصوصية</a>
                </div>
            </div>
        </footer>
    </div>


    <script>
        // Set the default visibility to show the login page first
        // Note: The login page is set to 'flex' in the style block for centering, so we use 'flex' here.
        document.getElementById('login-page-container').style.display = 'flex';
        document.getElementById('dashboard-page-container').style.display = 'none';

        function toggleVisibility(hideId, showId) {
            document.getElementById(hideId).style.display = 'none';
            // Determine display type for the target
            if (showId === 'login-page-container') {
                document.getElementById(showId).style.display = 'flex';
            } else {
                document.getElementById(showId).style.display = 'block';
            }
        }
    </script>

    <script>
        // --- Data Mocking (Simulated Database) ---

        const observationsData = [{
            id: 1,
            title: "مخالفة نظام السلامة العامة - عدم ارتداء خوذه",
            category: "SAFETY",
            status: "OPEN",
            priority: "عاجل",
            location: "المحطة الرئيسية - منصة 5",
            reporter: "أحمد الفهد",
            notes: "تم رصد عامل صيانة لا يرتدي خوذة الأمان أثناء العمل في منطقة عالية الخطورة. تم توجيه الملاحظة للمسؤول الفوري.",
            images: [{
                url: "https://blumark24.github.io/Smrt-HSR/images/safety-before.webp",
                label: "قبل المعالجة (مخالفة)"
            }, {
                url: "https://blumark24.github.io/Smrt-HSR/images/safety-after.webp",
                label: "بعد المعالجة (تصحيح)"
            }],
            videoUrl: null,
            audioUrl: null,
            isComparative: true, // Can be compared (before/after)
            closedBy: null,
            closedAt: null,
            createdAt: new Date('2024-10-01T10:00:00')
        }, {
            id: 2,
            title: "تراكم النفايات في منطقة الانتظار",
            category: "ENVIRONMENT",
            status: "CLOSED",
            priority: "متوسط",
            location: "منطقة الانتظار - قطاع ب",
            reporter: "فاطمة محمد",
            notes: "تم الإبلاغ عن تراكم نفايات صلبة بالقرب من سلة المهملات. تم إرسال فريق النظافة والتعامل مع الملاحظة في غضون 3 ساعات.",
            images: [{
                url: "https://blumark24.github.io/Smrt-HSR/images/waste-before.webp",
                label: "قبل المعالجة (نفايات)"
            }, {
                url: "https://blumark24.github.io/Smrt-HSR/images/waste-after.webp",
                label: "بعد المعالجة (نظيف)"
            }],
            videoUrl: null,
            audioUrl: null,
            isComparative: true,
            closedBy: "خالد العلي",
            closedAt: new Date('2024-09-28T14:30:00'),
            createdAt: new Date('2024-09-28T11:00:00')
        }, {
            id: 3,
            title: "خلل في إضاءة الممر الرئيسي",
            category: "MAINTENANCE",
            status: "CLOSED",
            priority: "عاجل",
            location: "الممر الرئيسي - الدور الأول",
            reporter: "يوسف الرشيد",
            notes: "تم إبلاغ عن خلل في إحدى وحدات الإضاءة. تم استبدال الوحدة المعطوبة واختبار النظام بنجاح.",
            images: [{
                url: "https://blumark24.github.io/Smrt-HSR/images/light-issue.webp",
                label: "صورة الخلل"
            }],
            videoUrl: null,
            audioUrl: "https://blumark24.github.io/Smrt-HSR/audio/audio-sample.mp3",
            isComparative: false,
            closedBy: "محمد ناصر",
            closedAt: new Date('2024-10-02T09:00:00'),
            createdAt: new Date('2024-10-01T18:00:00')
        }, {
            id: 4,
            title: "تآكل في طبقة الأسفلت عند المدخل 3",
            category: "MAINTENANCE",
            status: "OPEN",
            priority: "عالي",
            location: "منطقة مواقف الحافلات - المدخل 3",
            reporter: "سارة الحمد",
            notes: "تم ملاحظة تآكل واضح في طبقة الأسفلت مما قد يشكل خطراً على المركبات الصغيرة. تم تحديد المنطقة بعلامات تحذيرية وطلب التخطيط لإصلاح عاجل.",
            images: [{
                url: "https://blumark24.github.io/Smrt-HSR/images/asphalt-issue.webp",
                label: "صورة التآكل"
            }],
            videoUrl: "https://blumark24.github.io/Smrt-HSR/video/video-sample.mp4",
            audioUrl: null,
            isComparative: false,
            closedBy: null,
            closedAt: null,
            createdAt: new Date('2024-10-03T08:30:00')
        }, {
            id: 5,
            title: "تلف في واجهة إحدى لوحات الإعلانات الرقمية",
            category: "QUALITY",
            status: "OPEN",
            priority: "متوسط",
            location: "الردهة الرئيسية - جوار المصعد أ",
            reporter: "علي القرني",
            notes: "تم ملاحظة شاشة إعلان رقمية بها خطوط عمودية تالفة. يؤثر على المظهر الجمالي وجودة الخدمة المقدمة.",
            images: [{
                url: "https://blumark24.github.io/Smrt-HSR/images/display-issue.webp",
                label: "صورة التلف"
            }, {
                url: "https://blumark24.github.io/Smrt-HSR/images/display-issue-2.webp",
                label: "صورة مقربة"
            }],
            videoUrl: null,
            audioUrl: null,
            isComparative: false,
            closedBy: null,
            closedAt: null,
            createdAt: new Date('2024-10-04T09:30:00')
        }, ];

        let currentSelectedObservation = null;
        let originalObservationsData = [...observationsData];

        // --- Utility Functions ---

        function formatTimeAgo(date) {
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);
            const minutes = Math.floor(diffInSeconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);

            if (diffInSeconds < 60) return "منذ لحظات";
            if (minutes < 60) return `منذ ${minutes} دقيقة`;
            if (hours < 24) return `منذ ${hours} ساعة`;
            return `منذ ${days} يوم`;
        }

        function getCategoryColor(category) {
            switch (category) {
                case 'SAFETY':
                    return 'bg-red-500 text-white';
                case 'MAINTENANCE':
                    return 'bg-blue-600 text-white';
                case 'ENVIRONMENT':
                    return 'bg-green-500 text-white';
                case 'QUALITY':
                    return 'bg-[var(--color-navy)] text-white';
                default:
                    return 'bg-gray-500 text-white';
            }
        }

        function getStatusColor(status) {
            return status === 'OPEN' ? 'bg-red-500' : 'bg-green-500';
        }

        function getPriorityBadge(priority) {
            let color;
            switch (priority) {
                case 'عاجل':
                    color = 'bg-red-600';
                    break;
                case 'عالي':
                    color = 'bg-yellow-500 text-black';
                    break;
                case 'متوسط':
                    color = 'bg-blue-600';
                    break;
                default:
                    color = 'bg-gray-500';
            }
            return `<span class="inline-flex items-center rounded-full ${color} px-3 py-1 text-xs font-medium text-white shadow-md">${priority}</span>`;
        }

        function getIcon(category) {
            switch (category) {
                case 'SAFETY':
                    return 'shield';
                case 'MAINTENANCE':
                    return 'wrench';
                case 'ENVIRONMENT':
                    return 'leaf';
                case 'QUALITY':
                    return 'award';
                default:
                    return 'help-circle';
            }
        }

        // --- KPI Logic ---

        function calculateKPIs() {
            const openReports = observationsData.filter(obs => obs.status === 'OPEN').length;
            const closedReports = observationsData.filter(obs => obs.status === 'CLOSED').length;
            const totalReports = observationsData.length;
            let totalImages = 0;
            let reportsWithNoImages = 0;

            observationsData.forEach(obs => {
                if (obs.images && obs.images.length > 0) {
                    totalImages += obs.images.length;
                } else {
                    reportsWithNoImages++;
                }
            });

            const docQuality = totalReports > 0 ?
                Math.round(((totalReports - reportsWithNoImages) / totalReports) * 100) :
                100;

            return {
                openReports,
                closedReports,
                totalImages,
                docQuality
            };
        }

        function renderKPIs() {
            const kpis = calculateKPIs();
            document.getElementById('kpi-open').textContent = kpis.openReports;
            document.getElementById('kpi-closed').textContent = kpis.closedReports;
            document.getElementById('kpi-images').textContent = kpis.totalImages;
            document.getElementById('kpi-missing').textContent = `${kpis.docQuality}%`;

            renderExecutiveInsight(kpis);
        }

        function renderExecutiveInsight(kpis) {
            document.getElementById('kpi-insight-result').innerHTML = `<div class="kpi-insight-container p-4 mt-4 bg-white rounded-xl"><p class="font-bold text-lg text-teal-700">ملخص تنفيذي مقترح:</p><p class="text-gray-700 mt-2">تظهر البيانات أن هناك ${kpis.openReports} ملاحظات مفتوحة، مع تركيز في قسم الصيانة (MAINTENANCE) بسبب مشكلة الطريق التي تم إدخالها حديثاً. يجب على الفريق التنفيذي مراجعة خطط العمل الفورية لتقليل متوسط زمن الإغلاق والتركيز على توثيق جميع الملاحظات بالصور لضمان جودة الإغلاق.</p></div>`;
        }


        // --- List & Filter Logic ---

        function renderObservationsList(data) {
            const listElement = document.getElementById('observationsList');
            listElement.innerHTML = ''; // Clear existing list

            if (data.length === 0) {
                listElement.innerHTML =
                    '<li class="text-center py-10 text-gray-500">لا توجد ملاحظات مطابقة لمعايير البحث.</li>';
                return;
            }

            data.forEach(obs => {
                const isActive = currentSelectedObservation && currentSelectedObservation.id === obs.id;
                const activeClass = isActive ? 'active' : '';
                const item = document.createElement('li');
                item.className =
                    `observation-item p-4 bg-white rounded-lg shadow-sm mb-3 ${activeClass}`;
                item.setAttribute('onclick', `showObservationDetail(${obs.id})`);

                item.innerHTML = `
                <div class="flex justify-between items-start">
                    <div class="flex items-center gap-2">
                        <span class="inline-flex items-center justify-center w-8 h-8 rounded-full ${getCategoryColor(obs.category)} flex-shrink-0">
                            <i data-lucide="${getIcon(obs.category)}" class="w-4 h-4"></i>
                        </span>
                        <div>
                            <p class="font-bold text-base text-[var(--color-navy)]">${obs.title}</p>
                            <p class="text-sm text-gray-600">${obs.location}</p>
                        </div>
                    </div>
                    <div class="flex-shrink-0 text-left">
                        <span class="text-xs font-semibold text-gray-500 block">${formatTimeAgo(obs.createdAt)}</span>
                        <span class="inline-block mt-1 text-xs px-2 py-0.5 rounded-full text-white ${getStatusColor(obs.status)}">${obs.status === 'OPEN' ? 'مفتوحة' : 'مغلقة'}</span>
                    </div>
                </div>
            `;
                listElement.appendChild(item);
            });
            lucide.createIcons(); // Re-render Lucide icons for new elements
        }

        function searchObservations() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filteredData = originalObservationsData.filter(obs =>
                obs.location.toLowerCase().includes(query) ||
                obs.title.toLowerCase().includes(query) ||
                obs.category.toLowerCase().includes(query)
            );
            renderObservationsList(filteredData);
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            renderObservationsList(originalObservationsData);
        }

        function filterObservations(status) {
            originalObservationsData = [...observationsData]; // Reset original data array

            // Update button styles
            document.getElementById('filter-all').classList.add('opacity-50');
            document.getElementById('filter-open').classList.add('opacity-50');
            document.getElementById('filter-closed').classList.add('opacity-50');

            let filteredData = observationsData;
            if (status === 'open') {
                filteredData = observationsData.filter(obs => obs.status === 'OPEN');
                document.getElementById('filter-open').classList.remove('opacity-50');
            } else if (status === 'closed') {
                filteredData = observationsData.filter(obs => obs.status === 'CLOSED');
                document.getElementById('filter-closed').classList.remove('opacity-50');
            } else {
                document.getElementById('filter-all').classList.remove('opacity-50');
            }

            // Update the data array used for rendering/search
            originalObservationsData = filteredData;
            document.getElementById('searchInput').value = ''; // Clear search when filtering
            renderObservationsList(originalObservationsData);

            if (originalObservationsData.length > 0) {
                showObservationDetail(originalObservationsData[0].id);
            } else {
                document.getElementById('observationDetail').innerHTML =
                    `<div class="text-center py-20 text-gray-500"><i data-lucide="monitor" class="w-16 h-16 mx-auto mb-4"></i><p class="text-xl font-medium">لا توجد ملاحظات لعرضها ضمن هذا الفلتر.</p></div>`;
            }
        }

        // --- Detail & Comparison Logic ---

        function showObservationDetail(id) {
            const obs = observationsData.find(o => o.id === id);
            if (!obs) return;

            currentSelectedObservation = obs;

            // Highlight the active item in the list
            document.querySelectorAll('.observation-item').forEach(item => item.classList.remove('active'));
            document.querySelector(`.observation-item[onclick="showObservationDetail(${id})"]`).classList.add(
                'active');

            const statusBadge = `<span class="inline-block mt-1 text-sm px-3 py-1 rounded-full font-bold text-white ${getStatusColor(obs.status)}">${obs.status === 'OPEN' ? 'ملاحظة مفتوحة' : 'تمت المعالجة'}</span>`;
            const audioHTML = obs.audioUrl ?
                `<div class="mt-4 border-t pt-4"><p class="font-semibold text-gray-700 mb-2">مقطع صوتي مُرفق:</p><audio controls src="${obs.audioUrl}">متصفحك لا يدعم عنصر الصوت.</audio></div>` :
                '';
            const videoHTML = obs.videoUrl ?
                `<div class="mt-4 border-t pt-4"><p class="font-semibold text-gray-700 mb-2">مقطع فيديو مُرفق:</p><video controls src="${obs.videoUrl}" class="rounded-lg shadow-md w-full" poster="https://blumark24.github.io/Smrt-HSR/images/video-poster.webp">متصفحك لا يدعم عنصر الفيديو.</video></div>` :
                '';
            const closedByHTML = obs.closedBy ?
                `<div class="flex items-center gap-1 text-sm text-green-700 mt-2"><i data-lucide="user-check" class="w-4 h-4"></i><span>تم الإغلاق بواسطة: <b>${obs.closedBy}</b> في ${obs.closedAt.toLocaleDateString('ar-SA')}</span></div>` :
                '';

            const detailHTML = `
                <div class="flex justify-between items-start mb-6">
                    <div class="max-w-[80%]">
                        <h3 class="text-4xl font-extrabold text-[var(--color-navy)] tracking-tight mb-2">${obs.title}</h3>
                        <p class="text-gray-600 flex items-center gap-2">
                            <i data-lucide="map-pin" class="w-5 h-5 text-teal-600"></i>
                            <span class="font-medium">${obs.location}</span>
                        </p>
                    </div>
                    ${statusBadge}
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 mb-6">
                    <div class="bg-teal-50 p-3 rounded-lg flex flex-col justify-center border-b-2 border-[var(--color-teal)]">
                        <p class="text-xs font-medium text-gray-600">المُبلِغ</p>
                        <p class="text-lg font-bold text-[var(--color-navy)]">${obs.reporter}</p>
                    </div>
                    <div class="bg-teal-50 p-3 rounded-lg flex flex-col justify-center border-b-2 border-[var(--color-teal)]">
                        <p class="text-xs font-medium text-gray-600">التصنيف</p>
                        <p class="text-lg font-bold text-[var(--color-navy)]">${obs.category}</p>
                    </div>
                    <div class="bg-teal-50 p-3 rounded-lg flex flex-col justify-center border-b-2 border-[var(--color-teal)]">
                        <p class="text-xs font-medium text-gray-600">الأولوية</p>
                        ${getPriorityBadge(obs.priority)}
                    </div>
                </div>

                <div class="mb-6">
                    <p class="font-bold text-xl text-gray-800 mb-2">الوصف والتفاصيل</p>
                    <p class="text-gray-700 leading-loose">${obs.notes}</p>
                    ${closedByHTML}
                </div>

                <div class="mb-8 border-t pt-6">
                    <p class="font-bold text-xl text-gray-800 mb-4">الصور والملفات المرفقة</p>
                    ${obs.isComparative && obs.images.length === 2 ? `
                        <div id="comparisonContainer" class="comparison-wrapper">
                            <img id="beforeImage" src="${obs.images[0].url}" alt="${obs.images[0].label}">
                            <div class="after-image" id="afterImageContainer">
                                <img id="afterImage" src="${obs.images[1].url}" alt="${obs.images[1].label}">
                            </div>
                            <div class="comparison-divider" id="comparisonDivider">
                                <div class="comparison-divider-handle">
                                    <i data-lucide="chevron-left-right" class="w-5 h-5 text-[var(--color-teal)]"></i>
                                </div>
                            </div>
                            <span class="comparison-label label-before">${obs.images[0].label}</span>
                            <span class="comparison-label label-after">قبل: ${obs.images[1].label}</span>
                        </div>
                        <p class="text-center text-sm text-gray-500 mt-2">اسحب الخط الفاصل للمقارنة بين الصور.</p>
                    ` : `
                        <div id="image-gallery" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            ${obs.images.map(img => `
                                <div class="image-container">
                                    <img src="${img.url}" alt="${img.label}" class="w-full h-auto">
                                    <span class="image-label">${img.label}</span>
                                </div>
                            `).join('')}
                        </div>
                    `}
                    ${videoHTML}
                    ${audioHTML}
                </div>

                <div id="ai-features" class="border-t pt-6 no-print">
                    <p class="font-bold text-xl text-gray-800 mb-4">تحليل الذكاء الاصطناعي ومهام الإغلاق</p>
                    <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                        <button onclick="showVisionAIModal(${obs.id})"
                            class="ai-button-vision py-3 px-4 rounded-lg text-sm font-semibold flex items-center justify-center">
                            <i data-lucide="eye" class="w-5 h-5 ml-2"></i>
                            Vision AI
                        </button>
                        <button onclick="showRootCauseModal(${obs.id})"
                            class="ai-button-root-cause py-3 px-4 rounded-lg text-sm font-semibold flex items-center justify-center">
                            <i data-lucide="zap" class="w-5 h-5 ml-2"></i>
                            تحليل السبب الجذري
                        </button>
                        <button onclick="showCommunicationDraftModal(${obs.id})"
                            class="ai-button-comm py-3 px-4 rounded-lg text-sm font-semibold flex items-center justify-center">
                            <i data-lucide="mail" class="w-5 h-5 ml-2"></i>
                            مسودة تواصل تنفيذي
                        </button>
                        <button onclick="showPDFModal(${obs.id})"
                            class="ai-button-primary py-3 px-4 rounded-lg text-sm font-semibold flex items-center justify-center">
                            <i data-lucide="file-text" class="w-5 h-5 ml-2"></i>
                            إنشاء تقرير PDF
                        </button>
                        <button onclick="showGroundingModal(${obs.id})"
                            class="ai-button-grounding py-3 px-4 rounded-lg text-sm font-semibold flex items-center justify-center">
                            <i data-lucide="check-circle" class="w-5 h-5 ml-2"></i>
                            طلب الإغلاق
                        </button>
                        <button onclick="showDynamicModal(${obs.id})"
                            class="ai-button-secondary py-3 px-4 rounded-lg text-sm font-semibold flex items-center justify-center">
                            <i data-lucide="settings" class="w-5 h-5 ml-2"></i>
                            إجراءات أخرى
                        </button>
                    </div>
                </div>
            `;

            document.getElementById('observationDetail').innerHTML = detailHTML;
            lucide.createIcons(); // Re-render Lucide icons for detail view

            if (obs.isComparative && obs.images.length === 2) {
                setupImageComparison();
            } else {
                // Ensure comparison listeners are removed if a non-comparative item is selected
                removeImageComparisonListeners();
            }
        }

        function setupImageComparison() {
            const container = document.getElementById('comparisonContainer');
            const divider = document.getElementById('comparisonDivider');
            const afterImageContainer = document.getElementById('afterImageContainer');

            if (!container || !divider || !afterImageContainer) return;

            let isDragging = false;

            const onDragStart = (e) => {
                e.preventDefault();
                isDragging = true;
                container.style.cursor = 'grabbing';
            };

            const onDrag = (e) => {
                if (!isDragging) return;

                // Determine X position based on mouse or touch
                let clientX = e.clientX || (e.touches && e.touches[0].clientX);
                if (!clientX) return;

                const rect = container.getBoundingClientRect();
                let x = clientX - rect.left;

                // Clamp the position to be within the container bounds
                x = Math.max(0, Math.min(x, rect.width));

                // Update the divider and after image mask
                divider.style.left = x + 'px';
                afterImageContainer.style.width = x + 'px';
            };

            const onDragEnd = () => {
                isDragging = false;
                container.style.cursor = 'ew-resize';
            };

            // Add event listeners
            container.addEventListener('mousedown', onDragStart);
            container.addEventListener('touchstart', onDragStart);
            window.addEventListener('mousemove', onDrag);
            window.addEventListener('touchmove', onDrag);
            window.addEventListener('mouseup', onDragEnd);
            window.addEventListener('touchend', onDragEnd);
        }

        function removeImageComparisonListeners() {
            // Placeholder for cleanup if needed, but in this single-page context, listeners can often stay.
            // For a robust application, the listeners added in setupImageComparison should be explicitly removed here.
        }

        // --- AI Feature Modals (Simulated) ---

        function openModal(id) {
            const modal = document.getElementById(id);
            if (modal) {
                modal.style.display = 'flex';
                document.body.classList.add('overflow-hidden');
            }
        }

        function closeModal(id) {
            const modal = document.getElementById(id);
            if (modal) {
                modal.style.display = 'none';
                document.body.classList.remove('overflow-hidden');
            }
        }

        function showVisionAIModal(id) {
            const obs = observationsData.find(o => o.id === id);
            if (!obs || obs.images.length === 0) {
                Swal.fire('خطأ', 'لا توجد صور مُرفقة لهذه الملاحظة لإجراء تحليل Vision AI.', 'error');
                return;
            }

            // Populate images
            document.getElementById('vision-images').innerHTML = obs.images.map(img => `
                <div class="image-container">
                    <img src="${img.url}" alt="${img.label}" class="w-full h-auto">
                    <span class="image-label">${img.label}</span>
                </div>
            `).join('');

            // Simulate AI analysis result
            document.getElementById('vision-text-result').innerHTML =
                `<div class="loading-spinner border-l-4 border-purple-700"></div> جاري تحليل الصور...`;

            openModal('visionModal');

            setTimeout(() => {
                let resultText;
                if (obs.category === 'SAFETY' && obs.id === 1) {
                    resultText =
                        `**تم تحديد:** خطر عدم ارتداء معدات الوقاية الشخصية (خوذة). **تصنيف الدقة:** 98%. **الإجراء المُوصى به:** إيقاف العمل فوراً وتطبيق العقوبة المناسبة.`;
                } else if (obs.category === 'MAINTENANCE' && obs.isComparative) {
                    resultText =
                        `**تم تحديد:** تآكل وتلف في طبقة الأسفلت. **التصنيف:** ضرر من الدرجة 3. **مقارنة بعد/قبل:** تم التحقق من وجود إصلاح في الصورة الثانية، لكن جودة الصورة الثانية لا توفر وضوحاً كافياً لتوثيق الإغلاق الكامل.`;
                } else {
                    resultText =
                        `**تحليل عام:** تم تحديد كائن واحد على الأقل بوضوح (سلة مهملات، تلف شاشة، إضاءة). **الحالة:** تتطلب معالجة بشرية للملاحظات المحددة.`;
                }
                document.getElementById('vision-text-result').innerHTML = resultText;
                lucide.createIcons();
            }, 2000);
        }

        function showRootCauseModal(id) {
            const obs = observationsData.find(o => o.id === id);
            if (!obs) return;

            openModal('rootCauseModal');
            document.getElementById('root-cause-list').innerHTML = `
                <div class="text-center py-4 text-gray-500">
                    <div class="loading-spinner border-l-4 border-red-800 mx-auto"></div> جاري توليد تحليل السبب الجذري...
                </div>
            `;

            setTimeout(() => {
                let analysis;
                if (obs.category === 'SAFETY') {
                    analysis = `
                        <li>**لماذا؟** لم يرتدِ العامل خوذة.
                        <li>**لماذا؟** لم يتم توفير المتابعة المباشرة من المشرف.
                        <li>**لماذا؟** تركيز المشرف منصب على مهمة أخرى بدلاً من المراقبة.
                        <li>**لماذا؟** نقص في عدد المشرفين المؤهلين لمنطقة العمل.
                        <li>**السبب الجذري:** **توزيع غير فعال للموارد البشرية** على المهام الحرجة (المراقبة والإشراف).
                    `;
                } else if (obs.category === 'MAINTENANCE' && obs.id === 4) {
                    analysis = `
                        <li>**لماذا؟** حدث تآكل في الأسفلت.
                        <li>**لماذا؟** جودة مواد الأسفلت المستخدمة في تلك المنطقة منخفضة.
                        <li>**لماذا؟** لم يتم الالتزام بالمواصفات القياسية عند التنفيذ.
                        <li>**لماذا؟** عدم وجود نظام فحص جودة للمواد قبل الاستخدام.
                        <li>**السبب الجذري:** **فشل في نظام فحص جودة المواد** في مرحلة التوريد/التنفيذ.
                    `;
                } else {
                    analysis = `
                        <li>**لماذا؟** حدثت الملاحظة [${obs.title}].
                        <li>**لماذا؟** (تحليل يحتاج إلى بيانات إضافية)
                        <li>**السبب الجذري:** (نتيجة التحليل)
                    `;
                }

                document.getElementById('root-cause-list').innerHTML = analysis;
                lucide.createIcons();
            }, 1800);
        }

        function showCommunicationDraftModal(id) {
            const obs = observationsData.find(o => o.id === id);
            if (!obs) return;

            openModal('commModal');
            document.getElementById('communication-draft-output').innerHTML = `
                <p class="text-center text-gray-500 py-4">
                    <div class="loading-spinner border-l-4 border-orange-600 mx-auto"></div> جاري توليد المسودة...
                </p>
            `;

            setTimeout(() => {
                const draft = `
                إلى: الإدارة التنفيذية
                من: نظام Smart HSR (تقرير آلي)
                الموضوع: **تنبيه عاجل - ملاحظة حرجة #${obs.id} (${obs.category})**

                تحية طيبة،

                نود أن نلفت انتباهكم إلى ملاحظة عالية الأهمية تم رصدها آلياً في النظام:

                **الموقع:** ${obs.location}
                **العنوان:** ${obs.title}
                **التفاصيل:** تم رصد ${obs.notes}، مما يتطلب تدخل فوري.
                **الأولوية:** ${obs.priority}

                **الإجراء المطلوب:**
                1. تحديد مسؤول الإغلاق في غضون ساعة واحدة.
                2. إرسال خطة عمل واضحة خلال 24 ساعة.
                3. مراجعة السبب الجذري المُحتمل لتفادي التكرار.

                يرجى التعامل مع هذه الملاحظة بأقصى سرعة ممكنة.

                مع خالص التقدير،
                فريق الجودة والمراقبة الرقمية.
            `;
                document.getElementById('communication-draft-output').innerHTML = draft;
            }, 1500);
        }

        function copyToClipboard(elementId) {
            const textToCopy = document.getElementById(elementId).innerText;
            navigator.clipboard.writeText(textToCopy).then(() => {
                Swal.fire('تم النسخ', 'تم نسخ محتوى المسودة إلى الحافظة بنجاح.', 'success');
            }, (err) => {
                Swal.fire('خطأ', 'فشل في نسخ المحتوى: ' + err, 'error');
            });
        }

        function showPDFModal(id) {
            document.getElementById('pdf-modal-id').textContent = `#${id}`;
            openModal('pdfModal');
        }

        function generatePDF() {
            closeModal('pdfModal');
            Swal.fire({
                title: 'جاري إنشاء التقرير',
                html: 'الرجاء الانتظار، يتم الآن تجميع البيانات وإعداد التقرير للطباعة.',
                timer: 2000,
                timerProgressBar: true,
                didOpen: () => {
                    Swal.showLoading();
                }
            }).then((result) => {
                if (result.dismiss === Swal.DismissReason.timer) {
                    window.print(); // Simulate printing to PDF
                    Swal.fire('تم الإعداد', 'نافذة الطباعة جاهزة.', 'success');
                }
            });
        }

        function showGroundingModal(id) {
            // Simulate a workflow action
            Swal.fire({
                title: 'طلب إغلاق الملاحظة',
                text: "هل أنت متأكد من أنك تريد المضي قدماً في إغلاق الملاحظة # " + id +
                    "؟ يتطلب هذا الإجراء توثيقاً كاملاً.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#10B981',
                cancelButtonColor: '#0A1931',
                confirmButtonText: 'نعم، قم بالإغلاق',
                cancelButtonText: 'إلغاء',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    // Simulation logic for closing report
                    const obsIndex = observationsData.findIndex(o => o.id === id);
                    if (obsIndex !== -1 && observationsData[obsIndex].status === 'OPEN') {
                        observationsData[obsIndex].status = 'CLOSED';
                        observationsData[obsIndex].closedBy = 'النظام (المدير)';
                        observationsData[obsIndex].closedAt = new Date();
                        calculateAndRenderAll();
                        Swal.fire(
                            'تم الإغلاق!',
                            'تم إغلاق الملاحظة وتحديث مؤشرات الأداء.',
                            'success'
                        );
                    } else if (obsIndex !== -1 && observationsData[obsIndex].status === 'CLOSED') {
                        Swal.fire('مغلقة بالفعل', 'هذه الملاحظة مغلقة مسبقاً.', 'info');
                    } else {
                        Swal.fire('خطأ', 'لم يتم العثور على الملاحظة.', 'error');
                    }
                }
            })
        }

        function showDynamicModal(id) {
            document.getElementById('dynamic-modal-title').innerHTML =
                `<i data-lucide="settings" class="w-6 h-6 text-gray-800"></i>إجراءات أخرى للملاحظة #${id}`;
            document.getElementById('dynamic-modal-body').innerHTML = `
                <p class="text-gray-700">هنا يمكن إضافة إجراءات أخرى ديناميكية مثل:
                    <ul class="list-disc pr-6 mt-3 space-y-2 text-gray-600">
                        <li>إعادة تعيين الأولوية</li>
                        <li>إضافة مهمة متابعة جديدة</li>
                        <li>إرسال تنبيه للمقاول المسؤول</li>
                        <li>تصدير بيانات الملاحظة كملف JSON</li>
                    </ul>
                </p>
            `;
            lucide.createIcons();
            openModal('dynamicModal');
        }

        // --- Initialization ---

        function calculateAndRenderAll() {
            calculateKPIs();
            renderKPIs();
            observationsData.sort((a, b) => b.createdAt - a.createdAt);
            originalObservationsData = [...observationsData]; // Ensure original data is updated
            renderObservationsList(originalObservationsData);

            if (observationsData.length > 0) {
                const logoObservation = observationsData.find(obs => obs.id === 4);
                if (logoObservation) {
                    showObservationDetail(logoObservation.id);
                } else {
                    showObservationDetail(observationsData[0].id);
                }
            }
        }

        function initApp() {
            calculateAndRenderAll();
            if (currentSelectedObservation && currentSelectedObservation.isComparative) {
                setupImageComparison();
            }
            lucide.createIcons(); // تأكد من إنشاء أيقونات lucide عند التحميل
        }
        
        // --- End of Dashboard Script ---
    </script>
    
    <script>
        // Placeholder for Firebase configuration (replace with actual config)
        const firebaseConfig = {
            // apiKey: "YOUR_API_KEY",
            // authDomain: "YOUR_AUTH_DOMAIN",
            // projectId: "YOUR_PROJECT_ID",
            // storageBucket: "YOUR_STORAGE_BUCKET",
            // messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            // appId: "YOUR_APP_ID"
        };
        
        // Mocking the behavior since no actual Firebase config is provided
        let confirmationResultGlobal = null;
        let lastPhoneUsed = '';
        let firebaseInitialized = false;

        function msg(message, type = '') {
            const msgBox = document.getElementById('msg-box');
            if (message) {
                msgBox.textContent = message;
                msgBox.className = type === 'success' ? 'success-msg' : 'error-msg';
                msgBox.style.display = 'block';
            } else {
                msgBox.style.display = 'none';
            }
        }

        function initFirebase() {
            // Mock initialization
            // if (!firebaseInitialized) {
            //     firebase.initializeApp(firebaseConfig);
            //     const auth = firebase.auth();
            //     window.auth = auth;
            //     firebaseInitialized = true;
            // }
            // Mock reCAPTCHA setup
            window.recaptchaVerifier = {
                clear: () => console.log('Mock reCAPTCHA cleared'),
                render: () => 'Mock Recaptcha ID',
                verify: () => Promise.resolve('Mock Recaptcha Token')
            };
        }

        function sendOTP(event) {
            event.preventDefault();
            
            // Mocking the buttons and UI for a single-page app
            const phoneInput = document.getElementById('phone');
            const phone = phoneInput.value.trim();
            const sendBtn = document.getElementById('send-btn');
            const verifyBtn = document.getElementById('verify-btn');
            const otpSection = document.getElementById('otp-section');
            const otpActions = document.getElementById('otp-actions');

            if (phone.length < 8) {
                msg('الرجاء إدخال رقم هاتف صحيح.', 'error');
                return;
            }

            initFirebase(); // Ensure mock Firebase is initialized

            // Disable button and show loading
            sendBtn.disabled = true;
            sendBtn.textContent = 'جاري الإرسال...';
            msg('جاري إرسال رمز التحقق...', '');

            // Mock successful OTP sending after a delay
            setTimeout(() => {
                lastPhoneUsed = phone;
                
                // Mock confirmation result (needed for verification)
                confirmationResultGlobal = {
                    verify: (otpCode) => new Promise((resolve, reject) => {
                        console.log(`Mock: Verifying OTP ${otpCode}`);
                        // Mock check: successful if code is '123456'
                        if (otpCode === '123456') {
                            resolve({user: {uid: 'mockUser123'}});
                        } else {
                            reject(new Error('رمز غير صحيح'));
                        }
                    })
                };

                // Update UI to OTP mode
                msg('تم إرسال رمز التحقق بنجاح (الرمز التجريبي: 123456)', 'success');
                phoneInput.readOnly = true;
                sendBtn.style.display = 'none';
                verifyBtn.style.display = 'block';
                verifyBtn.disabled = false;
                otpSection.style.display = 'block';
                otpActions.style.display = 'flex';
                document.getElementById('otp-code').focus();

            }, 2000);
        }

        function verifyOTP() {
            const otpCode = document.getElementById('otp-code').value.trim();
            const verifyBtn = document.getElementById('verify-btn');

            if (!otpCode || otpCode.length !== 6) {
                msg('الرجاء إدخال الرمز المكون من 6 أرقام', 'error');
                return;
            }

            if (!confirmationResultGlobal) {
                msg('فشل التحقق. حاول إرسال الرمز مرة أخرى.', 'error');
                return;
            }

            verifyBtn.disabled = true;
            verifyBtn.textContent = 'جاري التحقق...';
            msg('جاري التحقق من الرمز...', '');

            // Mock verification
            confirmationResultGlobal.verify(otpCode)
                .then((result) => {
                    msg('تم التحقق وتسجيل الدخول بنجاح', 'success');
                    
                    // Successful login: switch to dashboard
                    verifyBtn.textContent = 'تم الدخول';
                    setTimeout(() => {
                        toggleVisibility('login-page-container', 'dashboard-page-container');
                        window.onload(); // Initialize the dashboard view
                    }, 500);

                })
                .catch((err) => {
                    verifyBtn.disabled = false;
                    verifyBtn.textContent = 'تسجيل الدخول';
                    msg(err.message || 'رمز غير صحيح', 'error');
                });
        }

        function resendOTP() {
            // Mock resend
            if (!lastPhoneUsed) {
                msg('أرسل رقم الجوال أولاً', 'error');
                return;
            }
            msg('جاري إعادة الإرسال...', '');
            
            setTimeout(() => {
                msg('أُعيد إرسال رمز التحقق (الرمز التجريبي: 123456)', 'success');
            }, 1500);
        }

        function clearPhone() {
            document.getElementById('phone').value = '';
            document.getElementById('phone').readOnly = false;
            document.getElementById('otp-code').value = '';
            document.getElementById('otp-section').style.display = 'none';
            document.getElementById('otp-actions').style.display = 'none';
            
            // Reset buttons
            document.getElementById('send-btn').style.display = 'block';
            document.getElementById('send-btn').textContent = 'إرسال رمز التحقق';
            document.getElementById('send-btn').disabled = false;
            document.getElementById('verify-btn').style.display = 'none';

            msg('');
        }
    </script>

    </body>

</html>
