<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Smart HSR – تسجيل الدخول</title>

  <!-- تحسينات SEO والمشاركة -->
  <meta name="description" content="منصة Smart HSR لإدارة الجودة والمشاريع بذكاء واحترافية." />
  <meta name="theme-color" content="#0ea5a1" />
  <meta property="og:title" content="Smart HSR — تسجيل الدخول" />
  <meta property="og:description" content="النظام الذكي لإدارة المشاريع والملاحظات الميدانية." />
  <meta property="og:image" content="Smart_HSR_Dashboard_Logo.svg" />

  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary-teal:#0ea5a1;
      --secondary-navy:#0b2b3a;
    }
    *{box-sizing:border-box;}

    /* الخلفية العامة */
    body{
      margin:0;font-family:'Tajawal',sans-serif;
      background:radial-gradient(circle at 30% 20%,#0ea5a1 0%,#0b2533 85%);
      background-size:cover;
      min-height:100vh;
      display:flex;align-items:center;justify-content:center;
      color:#fff;overflow:hidden;padding:20px;
    }

    /* البطاقة */
    .card{
      width:380px;background:rgba(255,255,255,0.95);
      border-radius:24px;backdrop-filter:blur(14px);
      box-shadow:0 8px 25px rgba(0,0,0,0.25);
      padding:40px 30px;position:relative;overflow:hidden;
      transform:translateY(40px);opacity:0;
      animation:fadeUp 1.2s ease-out forwards;
      transition:transform .3s ease;
    }
    .card:hover{transform:translateY(-3px) rotateX(2deg) rotateY(-2deg);}
    @keyframes fadeUp{from{opacity:0;transform:translateY(40px);}to{opacity:1;transform:translateY(0);}}
    .card-header-line{
      position:absolute;top:0;left:0;right:0;height:4px;
      background:linear-gradient(90deg,var(--primary-teal),var(--secondary-navy));
      border-top-left-radius:24px;border-top-right-radius:24px;
      box-shadow:0 0 15px rgba(14,165,161,0.4);
    }

    /* الشعار */
    .logo{
      display:block;width:110px;margin:25px auto 15px;
      opacity:0;animation:fadeIn 1.3s ease forwards,float 4s ease-in-out infinite;
      animation-delay:.3s;filter:drop-shadow(0 0 10px rgba(0,255,255,0.3));
    }
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
    @keyframes float{0%,100%{transform:translateY(0);}50%{transform:translateY(-6px);}}

    h1{
      margin:10px 0 5px;text-align:center;font-size:1.9rem;font-weight:900;
      color:var(--secondary-navy);text-shadow:0 2px 8px rgba(14,165,161,0.3);
      animation:fadeIn 1.4s ease forwards;animation-delay:.5s;opacity:0;
    }
    p.lead{
      margin:0 0 25px;text-align:center;color:#4b5a63;font-weight:500;font-size:1rem;
      animation:fadeIn 1.5s ease forwards;animation-delay:.7s;opacity:0;
    }

    /* الحقول */
    .field{margin-bottom:18px;text-align:right;}
    .field label{display:block;margin-bottom:6px;color:#0b2b3a;font-size:14px;font-weight:600;}
    input[type="email"],input[type="password"]{
      width:100%;padding:13px 16px;border-radius:12px;border:1px solid #d4dce4;
      background:#f9fafb;color:#0b2b3a;font-size:15px;
      transition:border-color .3s,box-shadow .3s,background .3s;
    }
    input:focus{border-color:var(--primary-teal);box-shadow:0 0 0 3px rgba(14,165,161,0.15);background:#fff;outline:none;}

    /* الزر */
    .btn{
      width:100%;padding:14px;border-radius:12px;border:none;
      font-weight:700;font-size:1rem;color:#fff;
      background:linear-gradient(90deg,var(--primary-teal),#0b7285);
      box-shadow:0 10px 25px rgba(14,165,161,0.3);
      cursor:pointer;transition:all .3s ease;
      animation:fadeIn 1.6s ease forwards,pulseGlow 5s infinite ease-in-out;
      animation-delay:.9s;opacity:0;
    }
    @keyframes pulseGlow{0%,100%{box-shadow:0 0 25px rgba(14,165,161,0.3);}50%{box-shadow:0 0 40px rgba(14,165,161,0.55);transform:scale(1.02);}}
    .btn:hover{transform:scale(1.05);box-shadow:0 15px 30px rgba(14,165,161,0.45);}
    .btn:active{transform:scale(.97);box-shadow:0 5px 15px rgba(14,165,161,0.4);}

    .message{text-align:center;margin-top:15px;font-weight:600;font-size:15px;}
    .error{color:#dc3545;}.success{color:#198754;}
    .muted{font-size:13px;color:#607d8b;text-align:center;margin-top:15px;
      animation:fadeIn 1.6s ease forwards;animation-delay:1s;opacity:0;}

    /* شاشة التحميل */
    #loadingOverlay{
      position:fixed;inset:0;
      background:linear-gradient(135deg,#0b2b3a,#0ea5a1);
      display:none;align-items:center;justify-content:center;flex-direction:column;
      z-index:9999;color:white;text-align:center;
    }
    .loader-logo{width:120px;animation:pulse 1.6s infinite ease-in-out;
      filter:drop-shadow(0 0 15px rgba(255,255,255,0.7));}
    .loader-text{font-size:1.1rem;font-weight:700;margin-top:1.5rem;opacity:.9;}
    @keyframes pulse{0%{transform:scale(1);opacity:1;}50%{transform:scale(1.08);opacity:.8;}100%{transform:scale(1);opacity:1;}}
    .loading-spinner{
      border:3px solid rgba(255,255,255,.3);border-top:3px solid white;
      border-radius:50%;width:20px;height:20px;animation:spin 1s linear infinite;margin-left:10px;
    }
    @keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}

    /* توافق الجوال */
    @media (max-width:480px){
      .card{width:90%;padding:30px 20px;}
      h1{font-size:1.6rem;}
      .btn{font-size:.95rem;}
    }
  </style>
</head>

<body>
  <div class="card">
    <div class="card-header-line"></div>
    <img src="Smart_HSR_Dashboard_Logo.svg" alt="شعار Smart HSR" class="logo" />
    <h1>Smart HSR</h1>
    <p class="lead">تسجيل الدخول إلى لوحة القيادة التنفيذية</p>

    <form id="loginForm" onsubmit="event.preventDefault(); signInWithEmail();">
      <div class="field">
        <label for="email">البريد الإلكتروني:</label>
        <input id="email" name="email" type="email" placeholder="example@smart-hsr.com" required />
      </div>
      <div class="field">
        <label for="password">كلمة المرور:</label>
        <input id="password" name="password" type="password" placeholder="••••••••" required />
      </div>
      <button type="submit" id="loginButton" class="btn">تسجيل الدخول</button>
    </form>

    <div id="msg" class="message"></div>
    <div class="muted">هذا النظام مخصص للمديرين والمراقبين والمقاولين المعتمدين فقط.</div>
  </div>

  <div id="loadingOverlay">
    <img src="Smart_HSR_Dashboard_Logo.svg" alt="Smart HSR" class="loader-logo" />
    <p class="loader-text">جاري الدخول إلى النظام...</p>
  </div>
  
  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBfClVxFIXgUXL4olEv5SepUDtzk0dq3lo",
    authDomain: "gen-lang-client-0349944917.firebaseapp.com",
    projectId: "gen-lang-client-0349944917",
    storageBucket: "gen-lang-client-0349944917.firebasestorage.app",
    messagingSenderId: "883065484771",
    appId: "1:883065484771:web:c907bb5a51f68caad75cd6"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  async function signInWithEmail() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    const msg = document.getElementById("msg");

    msg.textContent = "جاري تسجيل الدخول...";
    msg.className = "message";

    try {
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;

      // 👇 تحقق من الأدوار (مراقب أو مقاول فقط)
      const allowedEmails = ["supervisor@smart-hsr.com", "contractor@smart-hsr.com"];
      if (!allowedEmails.includes(email.toLowerCase())) {
        msg.textContent = "❌ هذا الحساب غير مصرح له بالدخول إلى النظام.";
        msg.className = "message error";
        return;
      }

      // ✅ نجاح الدخول
      document.getElementById("loadingOverlay").style.display = "flex";
      setTimeout(() => {
        window.location.href = "dashboard.html"; // ← صفحة اللوحة التنفيذية
      }, 1200);

    } catch (error) {
      msg.textContent = "خطأ في تسجيل الدخول، تحقق من البيانات.";
      msg.className = "message error";
      console.error(error);
    }
  }

  window.signInWithEmail = signInWithEmail;
</script>

</body>
</html>
